- Overview of network scanning
	- Network scanning refers to a set of procedures used for identifying hosts, ports, and services in a network
	- Network scanning is one of the components of intelligence gathering which can be used by an attacker to create a profile of the target organization
	- Objectives of network scanning
		- To discover live hosts, IP addresses, and open ports of live hosts
		- To discover OS and system architecture
		- To discover services running on hosts
		- To disover vulnerabiliites in live hosts
- TCP communication flags
	- Standard TCP communications are controlled by flags in the TCP packet header
- TCP/IP communication
	- TCP session establishment
		- Three way handshake


**Ping Sweep Countermeasures**
- Configure the firewall to detect and prevent ping sweep attempts instantaneously
- Use intrusion detection systems and intrusion prevention systems to detect and prevent ping sweep attempts
- Carefully evaluate the type of ICMP traffic flowing through enterprise networks
- Terminate the connecton with any host sending more than 10 ICMP ECHO requests
- Use a DMZ and allow only commands such as ICMP ECHO_REPLY, HOST UNREACHABLE, and TIME EXCEEDED in the DMZ
- Limit ICMP traffic with access control lists (ACLs) to the ISP's specific IP addresses

**Port Scanning Countermeasures**
- Configure firewall and intrusion detection systems (IDS) rules to detect and block probes
- The firewall should be capable of detecting th eprobes sent by attackers using port-scanning tools
	- It should not allow traffic to passtrhough after simply inspecting the TCP header
	- The firewall should be able to examine the data contained in each packet before allowing traffic to pass thru it
- Run the port scanning  tools against hosts on the network to determine whether the firewall accurately detects the port scanning activity
- Some firewalls do a better job than others in terms of detecting stealth scans
	- For example, many firewalls have specific options for detecting SYN scans, whereas others ignore FIN scans
	- Ensure that the router, IDS, and firewall firmware are updated with their latest versions
	- Configure commerical firewalls to protect the network against fast port scans and SYN floods
	- Hackers use tools such as Nmap to perform OS detection to sniff the details of a remote OS
		- Its important to employ an IDS in such cases
		- For example. Snort
	- Keep as few ports open as possible and filter the rest, as an intruder may attempt to enter through any open port. Use a custom rule set to lock down the network, block unwatned ports at the firewall, and filter the following ports: 135-159, 256-258,389,445,1080,1745, and 3268
	- Block unwanted services running on the ports and update the service versions
	- Ensure that the versions of services running on the ports are non-vulnerable
	- Block inbound ICMP mesage types and all outbound ICMP type-3 unreachable messages at border routers arranged in front of the company's main firewall
	- Attackers attempt to perform source routing and send packets to the targets, which may not be reachable via the Internet, using an intermediate host that can interact with the target. Hence, it is necesaary to ensure that the firewall and router can block such source-routing techniques
	- Ensure that the mechanisms used for routing and filtering at the routers and firewalls, respectively, cannot be bypassed using a particlular source port of source routing methods
	- Test the IP address space using TCP and UDP port scans as well as ICMP probes to determine the network configuration and accessible ports
	- Ensure that the anti scanning and anti spoofing rules are configured
	- If a commericall firewall is in use, then ensure the following:
		- It is patched with the latest updates
		- It has correctly defined anti-spoofing rules
		- Its fast mode services are unusable
	- Ensure that TCP wrappers limit access to the network based on domain names or IP addreses
	- Test how the network firewall and IDS manages the fragmented packets using fragtest and fragroute
	- Use proxy servers to block fragmented or malformed packets
	- Ensure that the firewalls foreward open port scans to empty hosts or honeypots to make the port-scanning task difficult and time-consuming
	- Employ and intruison prevention system (IPS) to identify port scan attempts and blacklist IP addresses